# План разработки Easy Lessons Bot

## Отчет по прогрессу
- **Текущая итерация**: 3/12
- **Статус**: Итерация 3 завершена
- **Последнее обновление**: 2025-09-08

---

## Итерация 1: Базовая настройка проекта ✅
- [x] Создать структуру директорий согласно @vision.md
- [x] Настроить pyproject.toml с зависимостями (uv, aiogram, openai, pydantic-settings)
- [x] Создать Makefile с основными командами (install, lint, fmt, test, run)
- [x] Настроить базовое логирование в /log/app.log

## Итерация 2: Конфигурация и настройки ✅
- [x] Создать settings/config.py с pydantic-settings
- [x] Добавить валидацию обязательных переменных (TELEGRAM_BOT_TOKEN, OPENROUTER_API_KEY)
- [x] Создать .env.example с примерами переменных окружения
- [x] Протестировать загрузку конфигурации

## Итерация 3: Базовый Telegram бот ✅
- [x] Создать app/main.py как точку входа
- [x] Реализовать базовую инициализацию aiogram бота
- [x] Добавить обработчик команды /start
- [x] Протестировать подключение к Telegram API

## Итерация 4: LLM клиент
- [ ] Создать core/llm_client.py с openai клиентом для OpenRouter
- [ ] Реализовать базовый запрос к LLM с таймаутом и ретраями
- [ ] Добавить логирование запросов и ответов
- [ ] Протестировать подключение к OpenRouter API

## Итерация 5: Управление состоянием
- [ ] Создать core/session_state.py для in-memory состояния
- [ ] Реализовать SessionState с chat_id, active_topic, understanding_level
- [ ] Добавить управление историей сообщений (лимит 30)
- [ ] Протестировать сохранение и получение состояния

## Итерация 6: Система промптов
- [ ] Создать core/prompt_store.py для управления промптами
- [ ] Добавить базовые системные промпты в core/prompts/
- [ ] Реализовать сборку контекста для LLM
- [ ] Протестировать генерацию промптов

## Итерация 7: Обработка текстовых сообщений
- [ ] Создать bot/handlers.py с обработчиками сообщений
- [ ] Реализовать обработку свободного текста пользователя
- [ ] Интегрировать LLM клиент с обработчиками
- [ ] Протестировать полный цикл: сообщение → LLM → ответ

## Итерация 8: Команда "Новая тема"
- [ ] Добавить обработчик команды "Новая тема"
- [ ] Реализовать сброс состояния и установку активной темы
- [ ] Добавить валидацию названия темы
- [ ] Протестировать смену темы

## Итерация 9: Обработка ошибок и надежность
- [ ] Добавить обработку ошибок LLM (таймауты, 5xx)
- [ ] Реализовать user-friendly сообщения об ошибках
- [ ] Добавить graceful degradation при сбоях
- [ ] Протестировать поведение при ошибках

## Итерация 10: Тестирование
- [ ] Создать unit-тесты для core/ модулей
- [ ] Добавить тесты для LLM клиента с моками
- [ ] Создать тесты для обработчиков бота
- [ ] Достичь покрытия 60-70% ключевой логики

## Итерация 11: Docker и деплой
- [ ] Создать Dockerfile на базе python:3.12-slim
- [ ] Настроить установку зависимостей через uv
- [ ] Добавить команды docker-build и docker-run в Makefile
- [ ] Протестировать запуск в контейнере

## Итерация 12: Финальная интеграция и документация
- [ ] Создать README.md с инструкциями по запуску
- [ ] Добавить примеры использования бота
- [ ] Настроить pre-commit с ruff и pytest
- [ ] Провести полное тестирование всех функций

---

## Критерии готовности каждой итерации
- Код компилируется без ошибок
- Все тесты проходят
- Функционал можно протестировать вручную
- Логирование работает корректно
- Соблюдены принципы KISS и YAGNI
