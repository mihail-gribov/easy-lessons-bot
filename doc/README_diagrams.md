# Диаграммы архитектуры Easy Lessons Bot

Этот каталог содержит схемы и диаграммы, описывающие архитектуру и потоки обработки сообщений в Easy Lessons Bot.

## Созданные диаграммы

### 1. [message_processing_flow.md](message_processing_flow.md)
**Основная схема преобразования входящего сообщения в выходящее**

Содержит:
- Обзор двухмодельной архитектуры
- Детальная диаграмма потока обработки сообщений
- Схема компонентов и их взаимодействий
- Последовательность обработки (sequence diagram)
- Описание ключевых компонентов
- Типы сообщений и их обработка
- Сценарии работы
- Обработка ошибок и graceful degradation
- Персистентность данных
- Конфигурация

### 2. [architecture_diagram.md](architecture_diagram.md)
**Архитектурная диаграмма системы**

Содержит:
- Общая архитектура системы
- Детальная схема потока данных
- Схема компонентов и их взаимодействий
- Схема данных и состояний (ER-диаграмма)
- Схема конфигурации и зависимостей
- Схема обработки ошибок и graceful degradation
- Схема логирования и мониторинга

### 3. [simple_flow_diagram.md](simple_flow_diagram.md)
**Простая схема потока обработки сообщений**

Содержит:
- ASCII-диаграмма основного потока
- Детальная схема обработки по типам сообщений
- Схема компонентов системы
- Схема двухмодельной архитектуры
- Схема обработки ошибок

## Ключевые особенности архитектуры

### Двухмодельная архитектура
1. **Вспомогательная модель** - анализирует контекст и определяет сценарий
2. **Диалоговая модель** - генерирует финальный ответ

### Поддерживаемые типы сообщений
- **Текстовые сообщения** - прямая обработка
- **Голосовые сообщения** - транскрипция через Whisper API
- **Изображения** - анализ через GPT-4 Vision API
- **Документы** - обработка как изображения (если поддерживается)

### Сценарии работы
- **Discussion** - обсуждение темы
- **Explanation** - разъяснение вопроса
- **Unknown** - свободное общение
- **Image Analysis** - анализ изображений

### Graceful Degradation
- При недоступности LLM: использование предустановленных ответов
- При недоступности БД: работа в in-memory режиме
- При ошибках медиа-обработки: fallback на текстовый режим

### Персистентность
- SQLite база данных для хранения сессий и сообщений
- Автоматические миграции
- Graceful degradation при недоступности БД

## Технологический стек

- **Python 3.12** - основной язык
- **aiogram 3** - Telegram Bot API
- **OpenRouter API** - доступ к LLM моделям
- **SQLite** - база данных
- **Whisper API** - транскрипция аудио
- **GPT-4 Vision API** - анализ изображений
- **Docker** - контейнеризация

## Принципы разработки

- **KISS и YAGNI** - минимально необходимая сложность
- **Graceful Degradation** - работа при частичных сбоях
- **Двухмодельная архитектура** - разделение анализа и генерации
- **Единый пайплайн** - унифицированная обработка всех типов сообщений
- **Персистентность** - сохранение состояния между сессиями

Эти диаграммы помогают понять архитектуру системы и потоки обработки данных в Easy Lessons Bot.
